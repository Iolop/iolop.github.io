---
layout: post
title: DPDK 尝试(1)-开发一个小型dns服务
date: 2023-11-15 00:17 +0800
categories: [DPDK noob]
tags: [dpdk]
---
最近的学习暂时告一段落，一直看下去，不动手实操也不会有什么实际体验，还得是手写代码来走进每一个步骤才行。准备利用dpdk前面的知识，来尝试开发一个小型的dns服务，暂时名为[mdns-D](https://github.com/Iolop/mdns)。

这一篇就用来记录中途碰见的问题和怎么解决它们的。

## port_init

前面仿照着example写下来，先默认4个lcore和2个nic可用。碰到第一个问题，`rte_eth_dev_configure`中的最后一个参数`const struct rte_eth_conf * eth_conf`该怎么去理解和配置呢？

这里还得是直接去看源码，这个结构如下，一个个的来看就行。

```c
struct rte_eth_conf {
	uint32_t link_speeds; 
	struct rte_eth_rxmode rxmode; 
	struct rte_eth_txmode txmode; 
	uint32_t lpbk_mode;
	struct {
		struct rte_eth_rss_conf rss_conf; 
		struct rte_eth_vmdq_dcb_conf vmdq_dcb_conf;
		struct rte_eth_dcb_rx_conf dcb_rx_conf;
		struct rte_eth_vmdq_rx_conf vmdq_rx_conf;
	} rx_adv_conf;
	union {
		struct rte_eth_vmdq_dcb_tx_conf vmdq_dcb_tx_conf;
		struct rte_eth_dcb_tx_conf dcb_tx_conf;
		struct rte_eth_vmdq_tx_conf vmdq_tx_conf;
	} tx_adv_conf; 
	uint32_t dcb_capability_en;
	struct rte_eth_intr_conf intr_conf; 
};
```